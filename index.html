<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Distriction ‚Äî Create Preview Link</title>
  <meta name="description" content="Upload image + title + description + free view link ‚Üí generate a shareable preview URL.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #6C63FF;
      --primary-dark: #5a52d4;
      --secondary: #FF6584;
      --dark: #0F172A;
      --darker: #0A0F1F;
      --light: #F8FAFC;
      --gray: #94A3B8;
      --gray-dark: #475569;
      --success: #10B981;
      --warning: #F59E0B;
      --danger: #EF4444;
      --glass: rgba(255, 255, 255, 0.05);
      --glass-border: rgba(255, 255, 255, 0.1);
      --maxw: 980px;
      --shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      --radius: 12px;
      --transition: all 0.3s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', 'Noto Sans Bengali', sans-serif;
      background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
      color: var(--light);
      line-height: 1.6;
      min-height: 100vh;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      width: 100%;
      max-width: var(--maxw);
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .logo {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-bottom: 10px;
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 20px;
    }

    .logo-text {
      font-size: 28px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .tagline {
      color: var(--gray);
      font-size: 16px;
      max-width: 600px;
      margin: 0 auto;
    }

    .card {
      background: var(--glass);
      backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius);
      padding: 25px;
      box-shadow: var(--shadow);
      margin-bottom: 30px;
    }

    .card-header {
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card-icon {
      width: 40px;
      height: 40px;
      background: var(--primary);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .card-title {
      font-size: 22px;
      font-weight: 600;
    }

    .form-group {
      margin-bottom: 18px;
    }

    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
      color: var(--gray);
      font-size: 14px;
    }

    .input-field, .textarea-field {
      width: 100%;
      padding: 12px 14px;
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid var(--glass-border);
      border-radius: 8px;
      color: var(--light);
      font-size: 15px;
      transition: var(--transition);
    }

    .input-field:focus, .textarea-field:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.2);
    }

    .file-input-wrapper {
      position: relative;
      overflow: hidden;
      display: inline-block;
      width: 100%;
    }

    .file-input {
      position: absolute;
      left: -9999px;
    }

    .file-input-label {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 12px 14px;
      background: rgba(0, 0, 0, 0.2);
      border: 1px dashed var(--glass-border);
      border-radius: 8px;
      cursor: pointer;
      transition: var(--transition);
      text-align: center;
      font-size: 14px;
    }

    .file-input-label:hover {
      border-color: var(--primary);
      background: rgba(108, 99, 255, 0.05);
    }

    .file-input-label i {
      margin-right: 8px;
      color: var(--primary);
    }

    .image-preview {
      margin-top: 10px;
      max-width: 100%;
      max-height: 200px;
      display: none;
      border-radius: 8px;
      border: 1px solid var(--glass-border);
    }

    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .btn {
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
      flex: 1;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
    }

    .btn-secondary {
      background: transparent;
      border: 1px solid var(--glass-border);
      color: var(--gray);
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: var(--gray);
    }

    .hint {
      font-size: 13px;
      color: var(--gray);
      margin-top: 12px;
      padding: 10px 12px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 6px;
      border-left: 3px solid var(--primary);
    }

    .output-container {
      display: none;
      margin-top: 25px;
    }

    .output-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .output-title i {
      color: var(--primary);
    }

    .generated-link {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid var(--glass-border);
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 15px;
      word-break: break-all;
      font-size: 14px;
    }

    .generated-link a {
      color: var(--primary);
      text-decoration: none;
    }

    .generated-link a:hover {
      text-decoration: underline;
    }

    .action-buttons {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .action-btn {
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 13px;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      text-decoration: none;
      transition: var(--transition);
    }

    .action-btn.copy {
      background: var(--primary);
      color: white;
      border: none;
    }

    .action-btn.copy:hover {
      background: var(--primary-dark);
    }

    .action-btn.whatsapp {
      background: #25D366;
      color: white;
    }

    .action-btn.facebook {
      background: #1877F2;
      color: white;
    }

    .action-btn.twitter {
      background: #1DA1F2;
      color: white;
    }

    .preview-container {
      display: none;
      margin-top: 25px;
    }

    .preview-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .preview-title i {
      color: var(--primary);
    }

    .preview-card {
      display: flex;
      flex-direction: column;
      background: rgba(0, 0, 0, 0.3);
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow);
    }

    @media (min-width: 768px) {
      .preview-card {
        flex-direction: row;
      }
    }

    .preview-image {
      flex: 0 0 250px;
      max-width: 100%;
    }

    .preview-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .preview-content {
      padding: 20px;
      flex: 1;
    }

    .preview-content h3 {
      font-size: 20px;
      margin-bottom: 8px;
    }

    .preview-content p {
      color: var(--gray);
      margin-bottom: 15px;
      font-size: 14px;
    }

    .preview-button {
      display: inline-block;
      padding: 10px 18px;
      background: var(--primary);
      color: white;
      text-decoration: none;
      border-radius: 6px;
      font-weight: 600;
      transition: var(--transition);
      font-size: 14px;
    }

    .preview-button:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
    }

    .preview-share {
      margin-top: 15px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .warning {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 6px;
      padding: 12px;
      margin-top: 15px;
      color: var(--danger);
      font-size: 13px;
    }

    .footer {
      text-align: center;
      margin-top: 30px;
      color: var(--gray);
      font-size: 13px;
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }

    .loading {
      animation: pulse 1.5s infinite;
    }

    @media (max-width: 768px) {
      .card {
        padding: 20px;
      }
      
      .button-group {
        flex-direction: column;
      }
      
      .preview-card {
        flex-direction: column;
      }
      
      .preview-image {
        flex: 0 0 200px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo">
        <div class="logo-icon">D</div>
        <div class="logo-text">Distriction</div>
      </div>
      <p class="tagline">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶ï‡¶∞‡ßç‡¶∑‡¶£‡ßÄ‡¶Ø‡¶º ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶® ‚Äî ‡¶∏‡¶π‡¶ú, ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶ì ‡¶¨‡¶ø‡¶®‡¶æ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø‡ßá</p>
    </div>

    <div class="card">
      <div class="card-header">
        <div class="card-icon">
          <i>üì§</i>
        </div>
        <h2 class="card-title">‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
      </div>

      <form id="form">
        <div class="form-group">
          <label for="title">‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ</label>
          <input type="text" id="title" name="title" class="input-field" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" required>
        </div>

        <div class="form-group">
          <label for="desc">‡¶¨‡¶∞‡ßç‡¶£‡¶®‡¶æ</label>
          <textarea id="desc" name="desc" class="textarea-field" rows="2" placeholder="‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡¶ø‡¶™‡ßç‡¶§ ‡¶¨‡¶∞‡ßç‡¶£‡¶®‡¶æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® (‡¶è‡¶ï ‡¶¨‡¶æ ‡¶¶‡ßÅ‡¶á ‡¶≤‡¶æ‡¶á‡¶®)"></textarea>
        </div>

        <div class="form-group">
          <label for="target">‡¶ü‡¶æ‡¶∞‡ßç‡¶ó‡ßá‡¶ü URL</label>
          <input type="url" id="target" name="target" class="input-field" placeholder="https://example.com/your-content" required>
        </div>

        <div class="form-group">
          <label for="image">‡¶õ‡¶¨‡¶ø (‡¶™‡ßã‡¶∏‡ßç‡¶ü‡¶æ‡¶∞)</label>
          <div class="file-input-wrapper">
            <input type="file" id="image" name="image" class="file-input" accept="image/*" required>
            <label for="image" class="file-input-label">
              <i>üì∑</i> ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶® (JPG, PNG, GIF - ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö 500KB)
            </label>
          </div>
          <img id="imagePreview" class="image-preview" alt="Selected Image Preview">
        </div>

        <div class="button-group">
          <button type="submit" id="generate" class="btn btn-primary">
            <i>üöÄ</i> ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®
          </button>
          <button type="button" id="clear" class="btn btn-secondary">
            <i>üóëÔ∏è</i> ‡¶´‡¶∞‡ßç‡¶Æ ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®
          </button>
        </div>

        <div class="hint">
          <strong>‡¶ü‡¶ø‡¶™:</strong> ‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶∏‡¶æ‡¶á‡¶ú 500KB ‡¶è‡¶∞ ‡¶ï‡¶Æ ‡¶∞‡¶æ‡¶ñ‡ßÅ‡¶®‡•§ ‡¶õ‡¶¨‡¶ø Base64 ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨‡ßá URL-‡¶è ‡¶è‡¶®‡¶ï‡ßã‡¶° ‡¶π‡¶¨‡ßá‡•§ ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶ï‡ßç‡¶≤‡¶æ‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü-‡¶∏‡¶æ‡¶á‡¶° ‡¶ü‡ßÅ‡¶≤ ‚Äî ‡¶ï‡ßã‡¶®‡ßã ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞‡ßá ‡¶Ø‡¶æ‡¶Ø‡¶º ‡¶®‡¶æ‡•§
        </div>
      </form>

      <div id="output" class="output-container">
        <div class="output-title">
          <i>‚úÖ</i> ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!
        </div>
        
        <div class="generated-link">
          <a id="outLink" href="#" target="_blank" rel="noopener"></a>
        </div>
        
        <div class="action-buttons">
          <button id="copyBtn" class="action-btn copy">
            <i>üìã</i> ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®
          </button>
          <a id="wa" class="action-btn whatsapp" target="_blank">
            <i>üí¨</i> WhatsApp
          </a>
          <a id="fb" class="action-btn facebook" target="_blank">
            <i>üëç</i> Facebook
          </a>
          <a id="tw" class="action-btn twitter" target="_blank">
            <i>üê¶</i> Twitter
          </a>
        </div>
      </div>

      <div id="preview" class="preview-container">
        <div class="preview-title">
          <i>üëÅÔ∏è</i> ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®
        </div>
        
        <div class="preview-card">
          <div class="preview-image">
            <a id="pvImgLink" href="#" target="_blank" rel="noopener">
              <img id="pvImg" src="" alt="Preview image">
            </a>
          </div>
          <div class="preview-content">
            <h3 id="pvTitle">‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá</h3>
            <p id="pvDesc">‡¶¨‡¶∞‡ßç‡¶£‡¶®‡¶æ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá...</p>
            <a id="pvOpen" class="preview-button" href="#" target="_blank" rel="noopener">
              <i>üîó</i> ‡¶ü‡¶æ‡¶∞‡ßç‡¶ó‡ßá‡¶ü ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡ßá ‡¶Ø‡¶æ‡¶®
            </a>
            
            <div class="preview-share">
              <button id="pvCopy" class="action-btn copy">
                <i>üìã</i> ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®
              </button>
              <a id="pvWa" class="action-btn whatsapp" target="_blank">
                <i>üí¨</i> WhatsApp
              </a>
              <a id="pvFb" class="action-btn facebook" target="_blank">
                <i>üëç</i> Facebook
              </a>
              <a id="pvTw" class="action-btn twitter" target="_blank">
                <i>üê¶</i> Twitter
              </a>
            </div>
          </div>
        </div>
      </div>

      <div class="warning">
        <strong>‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ:</strong> ‡¶Ö‡¶®‡ßç‡¶Ø‡ßá‡¶∞ ‡¶ï‡¶™‡¶ø‡¶∞‡¶æ‡¶á‡¶ü‡¶ï‡ßÉ‡¶§ ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶¨‡¶æ ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßá‡¶® ‡¶®‡¶æ‡•§ ‡¶è‡¶á ‡¶ü‡ßÅ‡¶≤‡¶ü‡¶ø ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶ø‡¶ú‡¶∏‡ßç‡¶¨ ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§
      </div>
    </div>

    <div class="footer">
      <p>Distriction - ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü‡¶∞ | ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶ï‡ßç‡¶≤‡¶æ‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü-‡¶∏‡¶æ‡¶á‡¶°‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡ßá, ‡¶ï‡ßã‡¶® ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞‡ßá ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º ‡¶®‡¶æ</p>
    </div>
  </div>

  <script>
    // Helper: encode/decode JSON safely in URL
    function encodeData(obj) {
      const json = JSON.stringify(obj);
      return btoa(unescape(encodeURIComponent(json)))
        .replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');
    }

    function decodeData(str) {
      try {
        while (str.length % 4) str += '=';
        str = str.replace(/-/g, '+').replace(/_/g, '/');
        const json = decodeURIComponent(escape(atob(str)));
        return JSON.parse(json);
      } catch (e) {
        return null;
      }
    }

    // Read file as DataURL
    function fileToDataURL(file) {
      return new Promise((res, rej) => {
        const r = new FileReader();
        r.onload = () => res(r.result);
        r.onerror = () => rej(new Error('‡¶´‡¶æ‡¶á‡¶≤ ‡¶™‡¶°‡¶º‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá'));
        r.readAsDataURL(file);
      });
    }

    // Build share URL
    function buildShareUrl(encoded) {
      const loc = window.location;
      return loc.origin + loc.pathname + '?p=' + encoded;
    }

    // DOM Elements
    const form = document.getElementById('form');
    const output = document.getElementById('output');
    const preview = document.getElementById('preview');
    const generateBtn = document.getElementById('generate');
    const clearBtn = document.getElementById('clear');
    const imageInput = document.getElementById('image');
    const imagePreview = document.getElementById('imagePreview');

    // Show image preview
    imageInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (event) => {
          imagePreview.src = event.target.result;
          imagePreview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      } else {
        imagePreview.style.display = 'none';
      }
    });

    // Form submit handler
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      generateBtn.disabled = true;
      generateBtn.innerHTML = '<i>‚è≥</i> ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶ï‡¶∞‡¶£ ‡¶ö‡¶≤‡¶õ‡ßá...';
      generateBtn.classList.add('loading');

      output.style.display = 'none';
      preview.style.display = 'none';

      try {
        const fd = new FormData(form);
        const title = (fd.get('title') || '').trim();
        const desc = (fd.get('desc') || '').trim();
        const target = (fd.get('target') || '').trim();
        const file = fd.get('image');

        if (!title || !target || !file) {
          alert('‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ, ‡¶ü‡¶æ‡¶∞‡ßç‡¶ó‡ßá‡¶ü URL ‡¶è‡¶¨‡¶Ç ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶¨‡¶∂‡ßç‡¶Ø‡¶ï‡•§');
          throw new Error('Missing required fields');
        }

        if (file.size > 500 * 1024) {
          alert('‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá 500KB ‡¶è‡¶∞ ‡¶õ‡ßã‡¶ü ‡¶õ‡¶¨‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶® (Base64 URL ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£‡ßá)‡•§');
          throw new Error('File too large');
        }

        // Convert image to Base64
        const imageDataUrl = await fileToDataURL(file);
        const payload = { title, desc, target, image_url: imageDataUrl, createdAt: Date.now() };
        const encoded = encodeData(payload);
        const longUrl = buildShareUrl(encoded);

        // Optional: try TinyURL, fallback to long URL
        let finalUrl = longUrl;
        try {
          const res = await fetch(`https://tinyurl.com/api-create.php?url=${encodeURIComponent(longUrl)}`);
          const short = await res.text();
          if (short.startsWith('http')) finalUrl = short;
        } catch (err) {
          console.warn('TinyURL failed, using long URL');
        }

        // Update output
        document.getElementById('outLink').textContent = finalUrl;
        document.getElementById('outLink').href = finalUrl;

        // Copy button
        document.getElementById('copyBtn').onclick = async () => {
          try {
            await navigator.clipboard.writeText(finalUrl);
            const btn = document.getElementById('copyBtn');
            btn.innerHTML = '<i>‚úÖ</i> ‡¶ï‡¶™‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!';
            setTimeout(() => btn.innerHTML = '<i>üìã</i> ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®', 2000);
          } catch (e) {
            alert('‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
          }
        };

        // Social share links
        const text = encodeURIComponent(`${title} ‚Äî ${desc || ''} ${finalUrl}`);
        document.getElementById('wa').href = `https://wa.me/?text=${text}`;
        document.getElementById('fb').href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(finalUrl)}`;
        document.getElementById('tw').href = `https://twitter.com/intent/tweet?text=${encodeURIComponent(title)}&url=${encodeURIComponent(finalUrl)}`;

        output.style.display = 'block';
        alert('‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');

      } catch (err) {
        console.error('Error:', err);
        alert('‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ' + (err.message || '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø'));
      } finally {
        generateBtn.disabled = false;
        generateBtn.innerHTML = '<i>üöÄ</i> ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®';
        generateBtn.classList.remove('loading');
      }
    });

    clearBtn.addEventListener('click', () => {
      form.reset();
      output.style.display = 'none';
      preview.style.display = 'none';
      imagePreview.style.display = 'none';
    });

    // Preview rendering on page load
    (function init() {
      const urlParams = new URLSearchParams(window.location.search);
      const p = urlParams.get('p');
      if (p) {
        const payload = decodeData(p);
        if (payload && payload.title && payload.image_url) {
          // Hide form card
          document.querySelector('.card').style.display = 'none';

          // Set preview content
          document.getElementById('pvImg').src = payload.image_url;
          document.getElementById('pvImgLink').href = payload.target;
          document.getElementById('pvTitle').textContent = payload.title;
          document.getElementById('pvDesc').textContent = payload.desc || '';
          document.getElementById('pvOpen').href = payload.target;

          // Set page title & OG tags
          document.title = payload.title;
          const ogTags = [
            { property: 'og:title', content: payload.title },
            { property: 'og:description', content: payload.desc || '' },
            { property: 'og:image', content: payload.image_url },
            { property: 'og:url', content: window.location.href },
            { property: 'og:type', content: 'website' }
          ];
          ogTags.forEach(tag => {
            let meta = document.createElement('meta');
            meta.setAttribute('property', tag.property);
            meta.content = tag.content;
            document.head.appendChild(meta);
          });

          // Social share for preview page
          const pageUrl = window.location.href;
          document.getElementById('pvWa').href = `https://wa.me/?text=${encodeURIComponent(payload.title + ' ' + pageUrl)}`;
          document.getElementById('pvFb').href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(pageUrl)}`;
          document.getElementById('pvTw').href = `https://twitter.com/intent/tweet?text=${encodeURIComponent(payload.title)}&url=${encodeURIComponent(pageUrl)}`;

          document.getElementById('pvCopy').onclick = async () => {
            try {
              await navigator.clipboard.writeText(pageUrl);
              const btn = document.getElementById('pvCopy');
              btn.innerHTML = '<i>‚úÖ</i> ‡¶ï‡¶™‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!';
              setTimeout(() => btn.innerHTML = '<i>üìã</i> ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®', 2000);
            } catch (e) {
              alert('‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
            }
          };

          // Show preview
          preview.style.display = 'block';
        } else {
          document.getElementById('output').innerHTML = `
            <div class="warning">‡¶Ö‡¶¨‡ßà‡¶ß ‡¶¨‡¶æ ‡¶ï‡ßç‡¶∑‡¶§‡¶ø‡¶ó‡ßç‡¶∞‡¶∏‡ßç‡¶§ ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶°‡ßá‡¶ü‡¶æ‡•§</div>
          `;
          document.getElementById('output').style.display = 'block';
        }
      }
    })();
  </script>
</body>
</html>
